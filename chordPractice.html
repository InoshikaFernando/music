<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Chord Scale Excercise</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px; 
      background-image: url("./images/chordsPractice.png");
    }
    table {
      border-collapse: collapse; 
      margin: auto;
      background-color: white;
    } 
    h1, label {
        color: white;
    }
    td { border: 2px solid black; width: 180px; height: 100px; vertical-align: middle; }
    .beat {
      display: inline-block;   /* ‚úÖ makes them sit side by side */
      width: 30px;
      height: 20px;
      margin: 5px auto;
      border: 1px solid #444;
      border-radius: 4px;
      line-height: 20px;
      text-align: center;
      font-weight: bold;
    }
    .active1 {
      background-color: lightcyan;
      animation: blink 0.3s alternate;
    }
    .active2 {
      background-color: rgb(116, 197, 224);
      animation: blink 0.3s alternate;
    }
    .emoji {
      font-size: 2em;   /* change size */
      line-height: 1;   /* keep spacing tight */
    }

    #guitar {
      background-color: lightcyan;
    }
    #violin {
      background-color: rgb(116, 197, 224);
    }
    @keyframes blink {
      from { background-color: lightblue; }
      to { background-color: white; }
    }
  </style>
</head>
<body>
  <h1>Chord/ Scale Exercise</h1>

  <label>Tempo (BPM):</label>
  <select id="tempo">
    <option value="60">60</option>
    <option value="80">80</option>
    <option value="100" selected>100</option>
    <option value="120">120</option>
    <option value="140">140</option>
  </select>

  <label>Time Signature:</label>
  <select id="timeSignature">
    <option value="2">2/4</option>
    <option value="3">3/4</option>
    <option value="4" selected>4/4</option>
  </select>

  <label style="margin-left:20px; color:white;">Chord Progression:</label>
  <select id="chordSelector">
    <option value="2" selected>2 chords</option>
    <option value="3">3 chords</option>
    <option value="4">4 chords</option>
  </select>

  <button id="playBtn">‚ñ∂ Play</button>
  <button id="stopBtn">‚èπ Stop</button>

  <table>
    <tr id="row1"></tr>
    <tr id="row2"></tr>
  </table>
  
  <button onclick="location.href='index.html'">‚Üê Back to Music Collection</button>
  <script>
    const chordLevel = document.getElementById("chords");
    
    // const chords = ["C", "C", "G", "G"]; // Example chords
    // Chord progressions for each option
    const chordProgressions = {
      2: ["C", "G", "C", "G"],
      3: ["C", "D", "G", "D"],
      4: ["C", "D", "Em", "G"]
    };

    const chordSelector = document.getElementById("chordSelector");
    // Set initial chords
    let chords = chordProgressions[chordSelector.value];

    // Update chords and re-render bars on selection
    chordSelector.addEventListener("change", () => {
      chords = chordProgressions[chordSelector.value];
      renderBars();
    });
    const row1 = document.getElementById("row1");
    const row2 = document.getElementById("row2");
    const playBtn = document.getElementById("playBtn");
    const stopBtn = document.getElementById("stopBtn");
    const tempoSelect = document.getElementById("tempo");
    const timeSignatureSelect = document.getElementById("timeSignature");

    let interval, currentBeat = 0;
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();

    function renderBars() {
      row1.innerHTML = "<td id='guitar'> <span class='emoji'>üé∏</span> Guitar chords </td>";
      row2.innerHTML = "<td id='violin'> <span class='emoji'>üéª</span> Violin notes </td>";
      const beatsPerBar = parseInt(timeSignatureSelect.value);
      chords.forEach((chord, barIndex) => {
        const td = document.createElement("td");
        for (let i = 0; i < beatsPerBar; i++) {
          const beatDiv = document.createElement("div");
          beatDiv.className = "beat";
          beatDiv.textContent = chord;
          beatDiv.id = `bar${barIndex}-beat${i}`;
          td.appendChild(beatDiv);
        }
        row1.appendChild(td);
      });
      chords.forEach((chord, barIndex) => {
        const td = document.createElement("td");
        for (let i = 0; i < beatsPerBar; i++) {
          const beatDiv = document.createElement("div");
          beatDiv.className = "beat";
          if (chord === "C") {
            if (i === 0) {
              beatDiv.textContent = "C"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 1) {
              beatDiv.textContent = "D"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 2) {
              beatDiv.textContent = "E"; //
              console.log(beatDiv.textContent);
            }
            else {
              beatDiv.textContent = "F"; //
              console.log(beatDiv.textContent);
            }
          }
          if (chord === "D") {
            if (i === 0) {
              beatDiv.textContent = "D"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 1) {
              beatDiv.textContent = "E"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 2) {
              beatDiv.textContent = "F"; //
              console.log(beatDiv.textContent);
            }
            else {
              beatDiv.textContent = "G"; //
              console.log(beatDiv.textContent);
            }
          }
          if (chord === "Em") {
            if (i === 0) {
              beatDiv.textContent = "E"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 1) {
              beatDiv.textContent = "F"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 2) {
              beatDiv.textContent = "G"; //
              console.log(beatDiv.textContent);
            }
            else {
              beatDiv.textContent = "A"; //
              console.log(beatDiv.textContent);
            }
          }
          if (chord === "G") {
            if (i === 0) {
              beatDiv.textContent = "G"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 1) {
              beatDiv.textContent = "A"; //
              console.log(beatDiv.textContent);
            }
            else if (i === 2) {
              beatDiv.textContent = "B"; //
              console.log(beatDiv.textContent);
            }
            else {
              beatDiv.textContent = "C"; //
              console.log(beatDiv.textContent);
            }
          }
          beatDiv.id = `note${barIndex}-beat${i}`;
          td.appendChild(beatDiv);
        }
        row2.appendChild(td);
      });
    }

    function playClick(isStrong) {
      const osc = audioCtx.createOscillator();
      const gain = audioCtx.createGain();
      osc.connect(gain);
      gain.connect(audioCtx.destination);
      osc.frequency.value = isStrong ? 880 : 440;
      gain.gain.value = 0.2;
      osc.start();
      osc.stop(audioCtx.currentTime + 0.1);
    }

    function startPlayback() {
      stopPlayback();
      const bpm = parseInt(tempoSelect.value);
      const beatDuration = (60 / bpm) * 1000;
      const beatsPerBar = parseInt(timeSignatureSelect.value);
      const totalBeats = chords.length * beatsPerBar;
      currentBeat = 0;

      interval = setInterval(() => {
        document.querySelectorAll(".beat").forEach(el => el.classList.remove("active1"));
        document.querySelectorAll(".beat").forEach(el => el.classList.remove("active2"));
        const barIndex = Math.floor(currentBeat / beatsPerBar);
        const beatIndex = currentBeat % beatsPerBar;
        const activeDiv1 = document.getElementById(`bar${barIndex}-beat${beatIndex}`);
        const activeDiv2 = document.getElementById(`note${barIndex}-beat${beatIndex}`);
        if (activeDiv1) activeDiv1.classList.add("active1");
        if (activeDiv2) activeDiv2.classList.add("active2");

        playClick(beatIndex === 0); // strong click on first beat

        currentBeat = (currentBeat + 1) % totalBeats;
      }, beatDuration);
    }

    function stopPlayback() {
      clearInterval(interval);
      document.querySelectorAll(".beat").forEach(el => el.classList.remove("active1"));
      document.querySelectorAll(".beat").forEach(el => el.classList.remove("active2"));
      currentBeat = 0;
    }

    timeSignatureSelect.addEventListener("change", renderBars);
    playBtn.addEventListener("click", () => {
      audioCtx.resume();
      startPlayback();
    });
    stopBtn.addEventListener("click", stopPlayback);

    renderBars();
  </script>
</body>
</html>
